<div class="container py-4" style="max-width: 800px;">

    <!-- Loading State -->
    <div *ngIf="loading && !currentQuestion" class="d-flex justify-content-center align-items-center"
        style="min-height: 50vh;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Game Content -->
    <div *ngIf="currentQuestion && !loading">
        <!-- Header: Streak & Progress -->
        <div class="d-flex justify-content-between mb-4">
            <div class="badge bg-light text-dark shadow-sm p-2 px-3">
                <i class="fa fa-fire text-danger me-1"></i> Streak: {{ currentQuestion.currentStreak }}
            </div>
            <div class="badge bg-light text-dark shadow-sm p-2 px-3">
                Q {{ currentQuestion.questionNumber }} / {{ currentQuestion.totalQuestions }}
            </div>
        </div>

        <!-- Question Card -->
        <div class="card shadow border-0 mb-4">
            <div class="card-body p-4 text-center">
                <h4 class="card-title fw-bold mb-3">{{ currentQuestion.content }}</h4>

                <div *ngIf="currentQuestion.mediaUrl" class="mb-3">
                    <!-- Media placeholder -->
                    <img [src]="currentQuestion.mediaUrl" class="img-fluid rounded" style="max-height: 200px;" />
                </div>
            </div>
        </div>

        <!-- Answer Options -->
        <div class="row g-3">
            <div class="col-md-6" *ngFor="let answer of currentQuestion.answers">
                <button class="btn btn-outline-primary w-100 p-3 h-100 fw-bold border-2 text-start position-relative"
                    (click)="submitAnswer(answer.id!)" [disabled]="submitting || !!lastResult" [ngClass]="{
            'btn-success text-white border-success': lastResult?.correctAnswerId === answer.id,
            'btn-danger text-white border-danger': lastResult && !lastResult.isCorrect && lastResult.correctAnswerId !== answer.id && answer.id === (currentQuestion.selectedAnswerId || '')
          }">
                    <span class="badge bg-secondary me-2 float-start">{{ answer.letter }}</span>
                    {{ answer.content }}

                    <!-- Result Icon -->
                    <i *ngIf="lastResult?.correctAnswerId === answer.id"
                        class="fa fa-check position-absolute top-50 end-0 translate-middle-y me-3"></i>
                    <!-- Note: We don't track selectedId in template easily without local var, but simpler approach is just highlight correct one. -->
                </button>
            </div>
        </div>

        <!-- Feedback Overlay/Footer -->
        <div *ngIf="lastResult" class="mt-4 p-3 rounded"
            [ngClass]="lastResult.isCorrect ? 'bg-success text-white' : 'bg-danger text-white'">
            <div class="d-flex align-items-center">
                <i class="fa fa-2x me-3" [ngClass]="lastResult.isCorrect ? 'fa-check-circle' : 'fa-times-circle'"></i>
                <div>
                    <h5 class="mb-0">{{ lastResult.isCorrect ? 'Correct!' : 'Wrong!' }}</h5>
                    <small>+{{ lastResult.xpEarned }} XP</small>
                </div>
            </div>
            <div *ngIf="lastResult.explanation" class="mt-2 pt-2 border-top border-white border-opacity-25">
                {{ lastResult.explanation }}
            </div>
        </div>
    </div>
</div>