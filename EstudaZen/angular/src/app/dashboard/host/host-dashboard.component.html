<div *ngIf="loading" class="flex items-center justify-center p-8">
    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
</div>

<div *ngIf="!loading && data" class="relative flex min-h-screen w-full flex-col overflow-hidden pb-28">
    <!-- Header -->
    <header class="flex items-center justify-between p-6 pt-8 pb-2">
        <div class="flex items-center gap-3">
            <div class="flex flex-col">
                <span class="text-sm text-gray-500 dark:text-gray-400 font-medium">Welcome back,</span>
                <h2 class="text-xl font-bold leading-tight tracking-tight">Host Master</h2>
            </div>
        </div>
    </header>

    <!-- Stats Horizontal Scroll -->
    <div class="w-full overflow-x-auto no-scrollbar pl-6 py-6">
        <div class="flex gap-4 min-w-max pr-6">
            <!-- Card 1: MRR -->
            <div
                class="flex w-[180px] flex-col gap-3 rounded-xl p-5 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow-sm relative overflow-hidden group">
                <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Total MRR</p>
                <p class="text-2xl font-bold tracking-tight">{{ data.totalMrr | currency:'BRL' }}</p>
            </div>
            <!-- Card 2: Active Cities -->
            <div
                class="flex w-[180px] flex-col gap-3 rounded-xl p-5 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow-sm relative overflow-hidden group">
                <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Active Cities</p>
                <p class="text-2xl font-bold tracking-tight">{{ data.activeCities }}</p>
            </div>
            <!-- Card 3: Students -->
            <div
                class="flex w-[180px] flex-col gap-3 rounded-xl p-5 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow-sm relative overflow-hidden group">
                <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Total Students</p>
                <p class="text-2xl font-bold tracking-tight">{{ data.totalStudents }}</p>
            </div>
        </div>
    </div>

    <!-- Subscription Health -->
    <div class="px-6 pt-6">
        <h2 class="text-xl font-bold mb-4">Subscription Health</h2>
        <div
            class="flex flex-col gap-4 rounded-xl bg-white dark:bg-gray-800 p-6 border border-gray-200 dark:border-gray-700 shadow-sm">
            <div class="flex items-end justify-between mb-2">
                <div>
                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium mb-1">Total Subscriptions</p>
                    <p class="text-4xl font-bold tracking-tight text-gray-900 dark:text-white">{{
                        data.subscriptionHealth.total }}</p>
                </div>
            </div>
            <!-- Active -->
            <div class="space-y-2">
                <div class="flex justify-between text-sm font-medium">
                    <span class="flex items-center gap-2 text-gray-600 dark:text-gray-300">
                        <span class="w-2 h-2 rounded-full bg-emerald-500"></span> Active
                    </span>
                    <span class="text-gray-900 dark:text-white">{{ data.subscriptionHealth.active }}</span>
                </div>
                <div class="h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden">
                    <div class="h-full bg-emerald-500 rounded-full"
                        [style.width.%]="(data.subscriptionHealth.active / data.subscriptionHealth.total) * 100"></div>
                </div>
            </div>
            <!-- Active -->
            <div class="space-y-2">
                <div class="flex justify-between text-sm font-medium">
                    <span class="flex items-center gap-2 text-gray-600 dark:text-gray-300">
                        <span class="w-2 h-2 rounded-full bg-amber-500"></span> Trial
                    </span>
                    <span class="text-gray-900 dark:text-white">{{ data.subscriptionHealth.trial }}</span>
                </div>
                <div class="h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden">
                    <div class="h-full bg-amber-500 rounded-full"
                        [style.width.%]="(data.subscriptionHealth.trial / data.subscriptionHealth.total) * 100"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Activity Feed -->
    <div class="px-6 pt-8">
        <h2 class="text-xl font-bold mb-4">Recent Updates</h2>
        <div class="flex flex-col gap-3">
            <div *ngFor="let item of data.recentUpdates"
                class="flex items-center gap-4 p-4 rounded-xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700">
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-bold truncate">{{ item.title }}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400 truncate">{{ item.description }}</p>
                </div>
                <div class="px-2.5 py-1 rounded-md text-xs font-bold whitespace-nowrap" [ngClass]="{
                        'bg-emerald-500/10 text-emerald-500': item.status === 'Active',
                        'bg-amber-500/10 text-amber-500': item.status === 'Trial',
                        'bg-rose-500/10 text-rose-500': item.status === 'Expired'
                    }">
                    {{ item.status }}
                </div>
            </div>
        </div>
    </div>
</div>